{% extends "base.html" %}
{% load static %}

{% block title %}Calendrier{% endblock %}

{% block content %}
<div class="calendar-container">
    <h1>ðŸ“… Calendrier du {{ date }}</h1>

    <!-- Formulaire pour choisir une date -->
    <form method="get" action="{% url 'tables_app:calendar' %}" class="calendar-form">
        <label for="date">Choisir une date :</label>
        <input type="date" id="date" name="date" value="{{ date }}">
        <button type="submit">Voir</button>
    </form>

    <hr>

    <!-- Ã‰tat des tables -->
    <h2>Ã‰tat des tables</h2>
    <ul class="tables-list">
        {% for t in tables %}
            <li>
                Table <strong>{{ t.table.number_table }}</strong> â€” 
                <span class="{% if t.state == 'Libre' %}free{% else %}reserved{% endif %}">
                    {{ t.state }}
                </span>

                {% if t.state == "Libre" %}
                    <!-- Bouton pour ouvrir le modal -->
                    <button class="reserve-btn" onclick="openBookingModal({{ t.table.id }}, '{{ date }}')">
                        RÃ©server
                    </button>
                {% endif %}
            </li>
        {% empty %}
            <li>Aucune table pour ce jour.</li>
        {% endfor %}
    </ul>
</div>

<!-- Modal pour la rÃ©servation -->
<div id="bookingModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeBookingModal()">&times;</span>
        <h2>RÃ©server une table</h2>

        <form id="bookingForm" method="POST" action="{% url 'users_app:create_private_booking_user' 0 %}">
            {% csrf_token %}
            <input type="hidden" id="table_id" name="table_id" value="">
            <input type="hidden" id="date_input" name="date" value="">

            <label for="booking_type">Type de rÃ©servation :</label>
            <select id="booking_type" name="booking_type">
                <option value="privÃ©e">PrivÃ©e</option>
                <option value="publique">Publique</option>
            </select>
            <br><br>

            <label for="start_time">Heure de dÃ©but :</label>
            <input type="time" id="start_time" name="start_time" required>
            <br><br>

            <label for="duration">DurÃ©e (HH:MM:SS) :</label>
            <input type="text" id="duration" name="duration" value="01:00:00" required>
            <br><br>

            <button type="submit">Confirmer</button>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'tables_app/css/calendar.css' %}">
{% endblock %}

{% block extra_js %}
<script src="{% static 'tables_app/js/calendar.js' %}"></script>
{% endblock %}
